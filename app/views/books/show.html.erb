<h1 class="page-title"><%= @book.title %></h1>

<p><strong>Author:</strong> <%= @book.author_name %></p>
<p><strong>Publisher:</strong> <%= @book.publisher %></p>
<p><strong>Published Date:</strong> <%= @book.published_date %></p>
<p><strong>Status:</strong> <%= @book.status %></p>

<div class="section-card">
  <div class="section-header">
    <h2>About this Book</h2>
  </div>
  <p><%= @book.about.presence || "No description added yet." %></p>
</div>

<div class="section-card">
  <div class="section-header">
    <h2>Chapters</h2>
    <% if author_signed_in? && @book.author == current_author %>
      <%= link_to "Add Chapter", new_book_chapter_path(@book), class: "btn btn-primary" %>
    <% end %>
  </div>
  <% if @book.chapters&.any? %>
    <ol class="chapter-list">
      <% @book.chapters.each do |chapter| %>
        <li class="chapter-list-item">
          <%= link_to chapter.title, book_chapter_path(@book, chapter), class: "chapter-link" %>
          <% if @book.author == current_author %>
            <div class="inline-actions">
              <%= link_to "Edit", edit_book_chapter_path(@book, chapter), class: "btn btn-warning btn-sm" %>
              <%= button_to "Delete", book_chapter_path(@book, chapter), method: :delete, data: { confirm: "Are you sure?" }, class: "btn btn-danger btn-sm inline-form" %>
            </div>
          <% end %>
        </li>
      <% end %>
    </ol>
  <% else %>
    <p>No chapters yet.</p>
  <% end %>
</div>

<hr>

<h2>Comments</h2>

<% if @book.comments.any? %>
  <div class="comments-list">
    <% @book.comments.each do |comment| %>
      <div class="comment-box">
        <p>
          <strong><%= comment.author.email %>:</strong>
          <%= comment.content %>
        </p>
        <% if comment.author == current_author %>
          <div class="inline-actions">
            <%= link_to "Edit", edit_book_comment_path(@book, comment), class: "btn btn-sm btn-warning" %>
            <%= button_to "Delete", book_comment_path(@book, comment), method: :delete, data: { confirm: "Are you sure?" }, class: "btn btn-sm btn-danger inline-form" %>
          </div>
        <% end %>
      </div>
    <% end %>
  </div>
<% else %>
  <p>No comments yet.</p>
<% end %>
<% if author_signed_in? %>
  <h3>Add a Comment</h3>
  <%= form_with(model: [@book, Comment.new], local: true) do |form| %>
    <div class="form-group">
      <%= form.text_area :content,
            placeholder: "Write your comment here...",
            rows: 3,
            class: "form-control comment-input" %>
    </div>
    <div class="form-group">
      <%= form.submit "Post Comment", class: "btn btn-primary" %>
    </div>
  <% end %>
<% else %>
  <p>You must be logged in as an author to comment.</p>
<% end %>

<!-- âœ¨ Add only textarea style -->
<style>
  .comment-input {
    border: 1px solid #ccc;
    border-radius: 6px;
    padding: 10px;
    font-size: 14px;
    width: 100%;
    resize: none;
    transition: border-color 0.2s ease;
  }

  .comment-input:focus {
    outline: none;
    border-color: #007bff;
    box-shadow: 0px 0px 4px rgba(0, 123, 255, 0.3);
  }
</style>
<hr>

<hr>

<%= link_to "Back", (request.referer || all_books_path), class: "btn btn-secondary" %>

<style>
  .page-title {
    margin-bottom: 20px;
  }
  .comments-list {
    margin-top: 15px;
  }
  .comment-box {
    border: 1px solid #ddd;
    padding: 10px;
    margin-bottom: 8px;
    border-radius: 5px;
    background-color: #f9f9f9;
  }
  .comment-actions {
    margin-top: 5px;
  }
</style>
