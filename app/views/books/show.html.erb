<div class="book-detail">
  <div class="book-show-header">
    <h1 class="page-title"><%= @book.title %></h1>
  </div>

  <div class="meta-grid">
    <div class="meta-item">
      <span class="meta-label">Author</span>
      <strong class="meta-value"><%= @book.author_name %></strong>
    </div>
    <div class="meta-item">
      <span class="meta-label">Publisher</span>
      <strong class="meta-value"><%= @book.publisher %></strong>
    </div>
    <div class="meta-item">
      <span class="meta-label">Published</span>
      <strong class="meta-value"><%= @book.published_date %></strong>
    </div>
    <div class="meta-item">
      <span class="meta-label">Status</span>
      <strong class="meta-value"><%= @book.status %></strong>
    </div>
  </div>

  <div class="section-card">
    <h2>About this Book</h2>
    <p><%= @book.about.presence || "No description added yet." %></p>
  </div>

  <div class="section-card">
    <div class="section-header">
      <h2>Chapters</h2>
      <% if author_signed_in? && @book.author == current_author %>
        <%= link_to "Add Chapter", new_book_chapter_path(@book), class: "btn btn-primary" %>
      <% end %>
    </div>

    <% if @book.chapters.any? %>
      <ol class="chapter-list">
        <% @book.chapters.each do |chapter| %>
          <li class="chapter-list-item">
            <%= link_to chapter.title, book_chapter_path(@book, chapter), class: "chapter-link" %>
            <% if @book.author == current_author %>
              <div class="inline-actions">
                <%= link_to "Edit", edit_book_chapter_path(@book, chapter), class: "btn btn-warning btn-sm" %>
                <%= button_to "Delete", book_chapter_path(@book, chapter), method: :delete, data: { confirm: "Are you sure?" }, class: "btn btn-danger btn-sm inline-form" %>
              </div>
            <% end %>
          </li>
        <% end %>
      </ol>
    <% else %>
      <p>No chapters yet.</p>
    <% end %>
  </div>

  <div class="section-card">
    <h2>Comments</h2>
    <% if @book.comments.any? %>
      <div class="comments-list">
        <% @book.comments.each do |comment| %>
          <div class="comment-box">
            <p>
              <strong><%= comment.author.email %>:</strong>
              <%= comment.content %>
            </p>
            <% if comment.author == current_author %>
              <div class="inline-actions">
                <%= link_to "Edit", edit_book_comment_path(@book, comment), class: "btn btn-sm btn-warning" %>
                <%= button_to "Delete", book_comment_path(@book, comment),
                            method: :delete,
                            data: { confirm: "Are you sure?" },
                            class: "btn btn-sm btn-danger inline-form" %>
              </div>
            <% end %>
          </div>
        <% end %>
      </div>
    <% else %>
      <p>No comments yet.</p>
    <% end %>

    <% if author_signed_in? %>
      <h3>Add a Comment</h3>
      <%= form_with(model: [@book, Comment.new], local: true) do |form| %>
        <div class="form-group">
          <%= form.text_area :content,
                placeholder: "Write your comment here...",
                rows: 3,
                class: "form-control comment-input" %>
        </div>
        <div class="form-group">
          <%= form.submit "Post Comment", class: "btn btn-primary" %>
        </div>
      <% end %>
    <% else %>
      <p>You must be logged in as an author to comment.</p>
    <% end %>
  </div>

  <div class="section-footer">
    <%= link_to "Back to My Books", books_path, class: "btn btn-secondary" %>
  </div>
</div>
